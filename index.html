<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Departure Board</title>
<style>
    body {
        background: #111;
        font-family: "Courier New", monospace;
        color: #0f0;
        display: flex;
        justify-content: center;
        padding-top: 40px;
    }

    #board {
        width: 80%;
        max-width: 900px;
    }

    .row {
        display: grid;
        grid-template-columns: 2fr 1fr 1fr 1fr;
        padding: 12px;
        margin-bottom: 6px;
        background: #000;
        border: 1px solid #333;
        font-size: 26px;
        letter-spacing: 1px;
        text-transform: uppercase;
    }

    .flap {
        display: inline-block;
        animation: flap 0.6s ease-in-out;
    }

    @keyframes flap {
        0% { transform: rotateX(0deg); }
        50% { transform: rotateX(90deg); opacity: 0; }
        100% { transform: rotateX(0deg); opacity: 1; }
    }
</style>
</head>

<body>
<div id="board">Loading…</div>

<script>
async function loadSheet() {
    const url =
      "https://docs.google.com/spreadsheets/d/e/2PACX-1vSZC7o-uCL_EPgbwLY9Vrf4E0nN2XkeOtXBxUtqrm3y77GOV1T5NtX5skMusVZBbmuU5ikPsQssqZca/gviz/tq?tq=select%20*";

    const res = await fetch(url);
    const text = await res.text();

    // Extract JSON from Google's weird response
    const json = JSON.parse(text.substring(text.indexOf("{"), text.lastIndexOf("}") + 1));

    const rows = json.table.rows;

    // Convert rows → simple array of arrays
    const parsed = rows.map(r => r.c.map(c => c ? c.v : ""));

    // First 5 rows only
    const sliced = parsed.slice(0, 5);

    drawBoard(sliced);
}

function drawBoard(data) {
    const board = document.getElementById("board");
    board.innerHTML = "";

    data.forEach(cols => {
        const row = document.createElement("div");
        row.className = "row";

        cols.forEach(text => {
            const cell = document.createElement("div");
            cell.innerHTML = `<span class="flap">${text}</span>`;
            row.appendChild(cell);
        });

        board.appendChild(row);
    });
}

// Load now
loadSheet();

// Auto-refresh every 15 seconds
setInterval(loadSheet, 15000);
</script>
</body>
</html>
